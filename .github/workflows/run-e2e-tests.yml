name: Run E2E Tests

on: [pull_request]

jobs:
  run-e2e-tests:
    name: Run E2E Tests
    runs-on: ubuntu-latest

    services:
      postgres:
        image: bitnami/postgresql
        ports:
          - 5432:5432
        env:
          POSTGRESQL_USERNAME: postgres
          POSTGRESQL_PASSWORD: docker
          POSTGRESQL_DATABASE: shorten
      redis:
        image: redis
        ports:
          - 6379:6379

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - run: npm i -g pnpm

      - run: pnpm i --frozen-lockfile

      - run: pnpm test:e2e
        env:
          JWT_PRIVATE_KEY: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRDRMR1lxcG5XTzMxNDIKZyt6L21KWVFaYTFyb2NreFVNalFOeEhhNENZMTV2ZXpqSEd2c0p3bVBBRDVER05xTlNtSXkxN0puZFIrRmZDTwpPb2U4WjJWYVJQTldtSXpNbktQajFnYldzQ2xyS2dhT0lSakVpV1FrZGhDSzNNUGJNMHdneWs2V3RNb3RnSUNlCk9lMWlraS9FbkoxMVVsYjFvd3BVa3I2bWJNVVNSZzROUU1lVG83dDFYeHMvY2dpSkFwMGVFMGdtUUNMSkVzRFEKT3VaYzNzNzR2aDk1ZkZWaXpUb3dManpaYWE4ajdTWEpvTFZsSnBMSEd1YlhEeUtRNXQwZDl4Y0FLaEVNeWxKLwpBTDAvY1ZBSEVDZloyS2hGSDhOczAxQ05OZVBMRTNHZGxjZkMydHhUWHpuWjRUZEFvRFZsa29GVlhGQ3JncUNkCnBDY3pDclBaQWdNQkFBRUNnZ0VBR0ptckYzVjRiLzBKaldFYXJqUHhoU2JWRDljaDFzejltUEVxaUk0aFQ0VEoKZno5djJnVHBWNXRwVThhaitLaFVLWXFTUnUxSm5lVitHdFVudFJmeE9xZGMwVFBPT2k2WlN0bUJoRWpDVkV4KwpTWnF6aGpEaHo4RHh6eGdHNUp6RFFqbFhuTFlIV0FjVnlNbHdjKzNPaFNCcXRkRmZqQm9aS1N6Q01BUldiU0w1Cll3MkY2dVZTZ0l6R3lwYS9KMC9ySlpzdC95Z3JzUXNmbk0xSWpmUVdSRVlZZjNZN2thbjYvR3IzTUlhenErcXcKR0hpbm50YVhYOEx5M2tocElRMTNCdkxYYUgwMUFiSy83NHFSWFV2ZzN2SXh5bVN3K0cxSWIxNWFkaGk1UEs4ZwpWNU1wT3ZpUTRkTmxqOXZycEt1a21XaDJ4dUVYQUZMbldMZWtSNzhGSVFLQmdRRDlnTUxmS1dGd3NON3FWK1M5Ck5aY29JcUUzbWIvNUhTM0ZlSzZiVm1zbExVSXJCSHk1M3prWnZ0UDJEVmU4MmE2czlDK3dmV1k1WUZhcFJTcnMKRGZ0cGdnajBidDVOVEQvelY1OEx5YXF0MXZiNzZFcE05THFHMmplTTh5aS9Ja0Z4cVZOb29ZaTh3TjB4VENmRQpuQXVabTdXWU5abnFVTU8za1hZdjdWYllvUUtCZ1FENm5qTGpoRjhEZmJOa01VdUJWeEptVVNxcWF4Wk1TcVF2CnNSQnZGN1RSZk5xUWVhM0RnWUlBN201YTJ2MWlHTHcxUmxUZFRVczI4UFVySktLeXNXQmJvM1pKR0J4NDFFSWkKVm9iTEZhbmNNa1hoQTI2L2hUWERGTVJVZTJrTkJPWXgxYitqVjdySWZqQVNkdEhzbFQvNktRNlNDQ1V5WlRaQgpuN2ZpVjRsNE9RS0JnUUNMNHJXbDkydXhoNmc2b0cyMGl4SHlMOG5PcUtUcWpsTm5tSVNoYXpxTXRVRENCQ1BmClhYSmc1cENJUWl5Y0pYTGlOWXpyVXdkSnVnT1lQSGJHODZBOFJHazBtTWxLMWp5angwSVlleHdYK1hzbzNySEIKYlhwUVY3STNzU1pXOGt3eXNFRTZoNGl3djZ4UE83cm1IMFczYWRqM09Qeko4KzlNS0pTVE5lQ3FnUUtCZ0JoegplcytMeUtGVWtENEVPVE9qUlI1S2FQazdmVzl3RU5pK1U3WWkvL2M0VVRLclRISzRuZkJ0VXNMMmZxWWxkNmRTCjkxQ29DK0NPWGIwWjArM1BOSEY4WHp2K2FEaTVyTUlnNHdISldVc3NkSGpobHRxRXFwd2YySS9OZ3BCTW5CRGMKbzlmUjVWMU9RbTVxdlV4eHUwNHkxME1VSEZ6d1Z2ek1FbXE0MDZheEFvR0JBSU9Zc2xnMHJqM3RDMjBhcEZCWgp1dU41eXBGYW5ETXYxV1BKMDhXWmlSNllCSnRwOENIOGhhQ2hrZGhOYSt6WDhFYTBseW0wV3h6a2FGRy9iRFBmCmRpTWFtamxER21DOVNMRkdDc3hYWVY1ZUEzWlJJMmxjV1Z6UFQ5WlliVS9vSEY5dC9oRXkvT2k5c05kZWlRd3QKKzR2Mi9tbVhwK2lXeWNMV0lFWXFWVmxwCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
          JWT_PUBLIC_KEY: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRDRMR1lxcG5XTzMxNDIKZyt6L21KWVFaYTFyb2NreFVNalFOeEhhNENZMTV2ZXpqSEd2c0p3bVBBRDVER05xTlNtSXkxN0puZFIrRmZDTwpPb2U4WjJWYVJQTldtSXpNbktQajFnYldzQ2xyS2dhT0lSakVpV1FrZGhDSzNNUGJNMHdneWs2V3RNb3RnSUNlCk9lMWlraS9FbkoxMVVsYjFvd3BVa3I2bWJNVVNSZzROUU1lVG83dDFYeHMvY2dpSkFwMGVFMGdtUUNMSkVzRFEKT3VaYzNzNzR2aDk1ZkZWaXpUb3dManpaYWE4ajdTWEpvTFZsSnBMSEd1YlhEeUtRNXQwZDl4Y0FLaEVNeWxKLwpBTDAvY1ZBSEVDZloyS2hGSDhOczAxQ05OZVBMRTNHZGxjZkMydHhUWHpuWjRUZEFvRFZsa29GVlhGQ3JncUNkCnBDY3pDclBaQWdNQkFBRUNnZ0VBR0ptckYzVjRiLzBKaldFYXJqUHhoU2JWRDljaDFzejltUEVxaUk0aFQ0VEoKZno5djJnVHBWNXRwVThhaitLaFVLWXFTUnUxSm5lVitHdFVudFJmeE9xZGMwVFBPT2k2WlN0bUJoRWpDVkV4KwpTWnF6aGpEaHo4RHh6eGdHNUp6RFFqbFhuTFlIV0FjVnlNbHdjKzNPaFNCcXRkRmZqQm9aS1N6Q01BUldiU0w1Cll3MkY2dVZTZ0l6R3lwYS9KMC9ySlpzdC95Z3JzUXNmbk0xSWpmUVdSRVlZZjNZN2thbjYvR3IzTUlhenErcXcKR0hpbm50YVhYOEx5M2tocElRMTNCdkxYYUgwMUFiSy83NHFSWFV2ZzN2SXh5bVN3K0cxSWIxNWFkaGk1UEs4ZwpWNU1wT3ZpUTRkTmxqOXZycEt1a21XaDJ4dUVYQUZMbldMZWtSNzhGSVFLQmdRRDlnTUxmS1dGd3NON3FWK1M5Ck5aY29JcUUzbWIvNUhTM0ZlSzZiVm1zbExVSXJCSHk1M3prWnZ0UDJEVmU4MmE2czlDK3dmV1k1WUZhcFJTcnMKRGZ0cGdnajBidDVOVEQvelY1OEx5YXF0MXZiNzZFcE05THFHMmplTTh5aS9Ja0Z4cVZOb29ZaTh3TjB4VENmRQpuQXVabTdXWU5abnFVTU8za1hZdjdWYllvUUtCZ1FENm5qTGpoRjhEZmJOa01VdUJWeEptVVNxcWF4Wk1TcVF2CnNSQnZGN1RSZk5xUWVhM0RnWUlBN201YTJ2MWlHTHcxUmxUZFRVczI4UFVySktLeXNXQmJvM1pKR0J4NDFFSWkKVm9iTEZhbmNNa1hoQTI2L2hUWERGTVJVZTJrTkJPWXgxYitqVjdySWZqQVNkdEhzbFQvNktRNlNDQ1V5WlRaQgpuN2ZpVjRsNE9RS0JnUUNMNHJXbDkydXhoNmc2b0cyMGl4SHlMOG5PcUtUcWpsTm5tSVNoYXpxTXRVRENCQ1BmClhYSmc1cENJUWl5Y0pYTGlOWXpyVXdkSnVnT1lQSGJHODZBOFJHazBtTWxLMWp5angwSVlleHdYK1hzbzNySEIKYlhwUVY3STNzU1pXOGt3eXNFRTZoNGl3djZ4UE83cm1IMFczYWRqM09Qeko4KzlNS0pTVE5lQ3FnUUtCZ0JoegplcytMeUtGVWtENEVPVE9qUlI1S2FQazdmVzl3RU5pK1U3WWkvL2M0VVRLclRISzRuZkJ0VXNMMmZxWWxkNmRTCjkxQ29DK0NPWGIwWjArM1BOSEY4WHp2K2FEaTVyTUlnNHdISldVc3NkSGpobHRxRXFwd2YySS9OZ3BCTW5CRGMKbzlmUjVWMU9RbTVxdlV4eHUwNHkxME1VSEZ6d1Z2ek1FbXE0MDZheEFvR0JBSU9Zc2xnMHJqM3RDMjBhcEZCWgp1dU41eXBGYW5ETXYxV1BKMDhXWmlSNllCSnRwOENIOGhhQ2hrZGhOYSt6WDhFYTBseW0wV3h6a2FGRy9iRFBmCmRpTWFtamxER21DOVNMRkdDc3hYWVY1ZUEzWlJJMmxjV1Z6UFQ5WlliVS9vSEY5dC9oRXkvT2k5c05kZWlRd3QKKzR2Mi9tbVhwK2lXeWNMV0lFWXFWVmxwCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
          DATABASE_URL: 'postgresql://postgres:docker@localhost:5432/shorten?schema=public'
          REDIS_URL: 'redis://localhost:6379'
